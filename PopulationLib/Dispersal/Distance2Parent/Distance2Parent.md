# Description

Dispersal module that defines the location of new plants based on the parent's position.

New plants are randomly distributed around the parent tree. 
The probability density function (PDF) for dispersal is user-defined, and the distance between the parent and new seedlings is calculated using this PDF.
The size (geometry) and attributes of a plant are taken from the species file (see ``pyMANGA.PopulationLib.Species``).

# Usage

```xml
<dispersal>
    <type> Distance2Parent </type>
    <distribution>normal</distribution>
    <scale>0.5</scale>
    <loc>0</loc>
</dispersal>
```

# Attributes

- ``type`` (string): "Distance2Parent"
- ``distribution`` (str): The probability density function used for seed dispersal. 
Options include: 'normal', 'uniform', 'exponential', 'gamma', 'weibull', and 'lognormal'. 
Refer to [numpy random generator](https://numpy.org/doc/stable/reference/random/legacy.html) for details.

# Value

Returns a dictionary containing the positions of new plants, with keys `x` and `y` representing the positions in the 2D grid.

# Details
## Purpose

Defines the location of new plants added to the model based on the position of the parent plant.

## Process overview
### Model Domain

The positions of new plants are constrained by the model's spatial boundaries, which are specified in the project file (`pyMANGA.PopulationLib.PopulationLib`).

### getPositions

The position of new seedlings is calculated based on the position of the parent plant (`xp`, `yp`). 
For each plant, the distance between the parent and `N` seedlings is calculated using the specified probability density function (`getDistances`). 
The new seedling positions are then generated by adding a random displacement from the parent position using a random angle (uniformly distributed):

```python
angle = np.random.uniform(low=0, high=2 * np.pi, size=N)
x_new = xp + dist2parent * np.sin(angle)
y_new = yp + dist2parent * np.cos(angle)
```

The resulting positions are then checked against the model's boundaries and any seedlings that fall outside are discarded.

### getDistances

The distance between the parent plant and seedlings is determined using the chosen probability density function, drawn from the [numpy random generator](https://numpy.org/doc/stable/reference/random/legacy.html).

When the Weibull distribution is chosen, the distance from the parent to the seedling (dist2parent) is adjusted by a scaling factor (self.scale). 
By default, this factor is set to 10 to adjust the model, as Numpy's original calculation uses a scaling factor of 1. 
This adjustment helps avoid very small areas that could result in the new seeds landing directly under the old tree and dying.
However, the scaling factor can be adjusted to modify the model. 
For all other distributions, such as normal, uniform, exponential, gamma, and lognormal, the positions of the seedlings are calculated directly using Numpyâ€™s implementation without additional adjustments.

The number of seedlings (`N`) is defined by the plant's production, which is handled in the `pyMANGA.PopulationLib.Production` module. 

## Application & Restrictions

- This module requires seed production per individual, defined in ``pyMANGA.PopulationLib.Production``.
- The random dispersal function can be customized to any of the supported distributions: 'normal', 'uniform', 'exponential', 'gamma', 'weibull', or 'lognormal'.
- Note: It is important to choose distribution parameters (e.g., scale, loc, high, etc.) that produce biologically meaningful and spatially realistic dispersal distances. 
Unrealistic values may result in seedlings being placed, but due to the small area, they may die immediately or frequently fall outside the model domain.

# References

- `pyMANGA.PopulationLib.Production`
- `pyMANGA.PopulationLib.Dispersal`
- `pyMANGA.PopulationLib.Species`

# Author(s)

Marie-Christin Wimmler, Chris Wudel

# See Also

``pyMANGA.PopulationLib.Production``,  
``pyMANGA.PopulationLib.Dispersal``,  
``pyMANGA.PopulationLib.Species``

# Examples

1. **Uniform dispersal** within a radius of up to 20 meters around the parent tree:

```xml
<dispersal>
    <type> Distance2Parent </type>
    <distribution> uniform </distribution>
    <high> 20 </high>
</dispersal>
```

2. **Exponential dispersal** with a scale factor of 0.5, where most seeds land close to the parent tree:

```xml
<dispersal>
    <type> Distance2Parent </type>
    <distribution> exponential </distribution>
    <scale> 0.5 </scale>
</dispersal>
```